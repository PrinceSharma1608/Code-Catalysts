import { useState } from "react";
import {
  Home,
  User,
  Award,
  ClipboardList,
  FileText,
  LogOut,
  PlusCircle,
  Sun,
  Moon,
  University,
  Menu,
  Smile
} from "lucide-react";

export default function Dashboard() {
  // UI state
  const [active, setActive] = useState("home");
  const [selectedTile, setSelectedTile] = useState(null);
  const [dark, setDark] = useState(false);
  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);

  // Modals
  const [showEditModal, setShowEditModal] = useState(false);
  const [showPwdModal, setShowPwdModal] = useState(false);
  const [toast, setToast] = useState(null); // {message, type}

  // Dummy user + org
  const dummyData = {
    name: "John Doe",
    enrollment: "CSE2025001",
    email: "john.doe@univ.edu",
    contact: "+91 98765 43210",
    organisation: "Manipal University Jaipur",
    university: "Manipal University Jaipur",
    gpa: 8.7,
    stats: {
      seminars: { count: 5, items: ["Seminar on AI", "Seminar on ML"] },
      conferences: { count: 3, items: ["IEEE Conference", "Tech Conference"] },
      courses: { count: 4, items: ["Coursera Python", "edX DSA"] },
      internships: { count: 2, items: ["Google Summer Internship", "Startup Internship"] },
      volunteering: { count: 6, items: ["Tree Plantation Drive", "Blood Donation Camp"] },
      extracurriculars: { count: 8, items: ["Football Team", "Drama Club"] },
    },
  };

  const categories = Object.keys(dummyData.stats);

  const navItems = [
    { id: "home", label: "Home", icon: <Home size={20} /> },
    { id: "profile", label: "Profile", icon: <User size={20} /> },
    { id: "achievements", label: "Achievements", icon: <Award size={20} /> },
    { id: "activities", label: "Activities", icon: <ClipboardList size={20} /> },
    { id: "portfolio", label: "Portfolio", icon: <FileText size={20} /> },
    { id: "addAchievement", label: "Add Achievement", icon: <PlusCircle size={20} /> },
  ];

  // Dual-tone palette per theme
  const tone = dark
    ? {
        bg: "bg-neutral-900",
        panel: "bg-neutral-800",
        card: "bg-neutral-800",
        text: "text-neutral-100",
        subtext: "text-neutral-300",
        border: "border-neutral-700",
        accent: "text-cyan-300",
        chip: "bg-neutral-700",
        hover: "hover:bg-neutral-700",
        brand: "text-cyan-400",
        btn: "bg-cyan-500 hover:bg-cyan-400 text-neutral-900",
      }
    : {
        bg: "bg-slate-50",
        panel: "bg-white",
        card: "bg-white",
        text: "text-slate-900",
        subtext: "text-slate-600",
        border: "border-slate-200",
        accent: "text-indigo-600",
        chip: "bg-slate-100",
        hover: "hover:bg-slate-100",
        brand: "text-indigo-600",
        btn: "bg-indigo-600 hover:bg-indigo-500 text-white",
      };

  const showSuccess = (msg) => {
    setToast({ message: msg, type: "success" });
    setTimeout(() => setToast(null), 1800);
  };

  return (
    <div className={`${tone.bg} ${tone.text} flex h-screen transition-colors duration-200`}>
      {/* Sidebar */}
      <div
        className={`${tone.panel} ${tone.text} ${sidebarCollapsed ? "w-16" : "w-64"} border-r ${
          tone.border
        } shadow-sm flex flex-col transition-all duration-200`}
      >
        <div className={`flex items-center justify-between p-4 border-b ${tone.border}`}>
          <div className={`flex items-center gap-2 ${sidebarCollapsed ? "opacity-0 w-0" : "opacity-100"} transition-opacity`}>
            <University size={18} className={tone.brand} />
            <span className={`text-lg font-bold whitespace-nowrap ${sidebarCollapsed ? "hidden" : "block"}`}>
              Smart Student Hub
            </span>
          </div>
          <button
            aria-label="Toggle sidebar"
            onClick={() => setSidebarCollapsed((v) => !v)}
            className={`p-2 rounded-xl ${tone.hover}`}
          >
            <Menu size={18} />
          </button>
        </div>
        <nav className="flex-1 p-2 space-y-2">
          {navItems.map((item) => (
            <button
              key={item.id}
              onClick={() => {
                setActive(item.id);
                setSelectedTile(null);
              }}
              className={`flex items-center gap-3 w-full px-3 py-2 rounded-xl text-left text-sm font-medium transition-colors ${
                active === item.id
                  ? `${dark ? "bg-cyan-600 text-neutral-900" : "bg-indigo-100 text-indigo-700"}`
                  : `${tone.hover}`
              }`}
            >
              {item.icon}
              {!sidebarCollapsed && <span>{item.label}</span>}
            </button>
          ))}
        </nav>
        <button className={`flex items-center gap-2 px-3 py-2 m-2 rounded-xl ${tone.hover}`}>
          <LogOut size={20} />
          {!sidebarCollapsed && <span>Logout</span>}
        </button>
      </div>

      {/* Main Area */}
      <div className="flex-1 flex flex-col min-w-0">
        {/* Top bar */}
        <div className={`flex items-center justify-between px-4 py-3 border-b ${tone.border} ${tone.panel}`}>
          <div className="flex items-center gap-2">
            <University size={18} className={tone.brand} />
            <span className="font-semibold truncate">{dummyData.university}</span>
          </div>
          <button
            aria-label="Toggle theme"
            onClick={() => setDark((v) => !v)}
            className={`p-2 rounded-xl ${tone.hover}`}
            title={dark ? "Switch to light" : "Switch to dark"}
          >
            {dark ? <Sun size={18} /> : <Moon size={18} />}
          </button>
        </div>

        {/* Content */}
        <div className="flex-1 p-6 overflow-y-auto">
          {/* HOME */}
          {active === "home" && !selectedTile && (
            <div>
              <h1 className="text-2xl font-bold mb-6">Welcome, {dummyData.name}</h1>
              <div className="grid grid-cols-1 gap-4">
                {categories.map((cat) => (
                  <button
                    key={cat}
                    onClick={() => setSelectedTile(cat)}
                    className={`${tone.card} border ${tone.border} shadow-sm rounded-2xl p-5 flex justify-between items-center ${
                      tone.hover
                    } transition`}
                  >
                    <span className="text-lg font-semibold capitalize">{cat}</span>
                    <span className={`text-2xl font-bold ${tone.brand}`}>{dummyData.stats[cat].count}</span>
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* HOME detail */}
          {active === "home" && selectedTile && (
            <div>
              <button className={`${tone.accent} mb-4`} onClick={() => setSelectedTile(null)}>
                ‚Üê Back
              </button>
              <h1 className="text-2xl font-bold mb-6 capitalize">{selectedTile}</h1>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {dummyData.stats[selectedTile].items.map((item, i) => (
                  <div key={i} className={`${tone.card} border ${tone.border} rounded-2xl p-4 shadow-sm`}>
                    <p className="font-medium">{item}</p>
                    <div className={`mt-3 h-32 rounded-xl flex items-center justify-center ${tone.chip} ${tone.subtext}`}>
                      Certificate Preview
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* PROFILE */}
          {active === "profile" && (
            <div>
              <h1 className="text-2xl font-bold mb-6">Profile</h1>
              <div className={`grid grid-cols-1 lg:grid-cols-3 gap-6`}>
                {/* Left: details */}
                <div className={`lg:col-span-2 space-y-4`}>
                  <div className={`grid grid-cols-1 md:grid-cols-2 gap-4`}>
                    {[
                      { label: "Email ID", value: dummyData.email },
                      { label: "Unique ID No", value: dummyData.enrollment },
                      { label: "Contact No", value: dummyData.contact },
                      { label: "Current Organisation", value: dummyData.organisation },
                    ].map((t, i) => (
                      <div key={i} className={`${tone.card} border ${tone.border} rounded-2xl p-4`}>
                        <div className="text-sm opacity-70">{t.label}</div>
                        <div className="text-lg font-semibold mt-1 break-all">{t.value}</div>
                      </div>
                    ))}
                  </div>
                  <div className="flex gap-3 pt-2">
                    <button onClick={() => setShowPwdModal(true)} className={`px-4 py-2 rounded-xl ${tone.btn}`}>
                      Change Password
                    </button>
                    <button onClick={() => setShowEditModal(true)} className={`px-4 py-2 rounded-xl ${tone.hover} border ${tone.border}`}>
                      Change Personal Details
                    </button>
                  </div>
                </div>

                {/* Right: profile photo */}
                <div className={`flex justify-center lg:justify-end`}>
                  <div className={`${tone.card} border ${tone.border} rounded-2xl p-4 w-56 h-56 flex items-center justify-center`}>
                    <img
                      alt="Profile"
                      src="https://avatars.githubusercontent.com/u/9919?s=200&v=4"
                      className="w-full h-full object-cover rounded-xl"
                    />
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* ACHIEVEMENTS */}
          {active === "achievements" && (
            <div>
              <h1 className="text-2xl font-bold mb-4">Achievements</h1>
              <p className={`${tone.subtext}`}>Detailed list of all verified achievements will appear here.</p>
            </div>
          )}

          {/* ACTIVITIES */}
          {active === "activities" && (
            <div>
              <h1 className="text-2xl font-bold mb-4">Activities</h1>
              <p className={`${tone.subtext}`}>Detailed list of activities will appear here.</p>
            </div>
          )}

          {/* PORTFOLIO */}
          {active === "portfolio" && (
            <div>
              <h1 className="text-2xl font-bold mb-4">Portfolio</h1>
              <p className={`${tone.subtext}`}>Downloadable digital portfolio will be available here.</p>
            </div>
          )}

          {/* ADD ACHIEVEMENT */}
          {active === "addAchievement" && (
            <div>
              <h1 className="text-2xl font-bold mb-6">Add Achievement</h1>
              <form
                className="space-y-4 max-w-lg"
                onSubmit={(e) => {
                  e.preventDefault();
                  showSuccess("Achievement submitted for approval");
                }}
              >
                <div>
                  <label className="block text-sm font-medium mb-1">Title</label>
                  <input type="text" className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} placeholder="Achievement Title" />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Granting Organization</label>
                  <input type="text" className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} placeholder="Organization Name" />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Upload Certificate</label>
                  <input type="file" className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Certificate ID</label>
                  <input type="text" className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} placeholder="Certificate ID" />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Category</label>
                  <select className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`}>
                    <option>Seminars</option>
                    <option>Conferences</option>
                    <option>Online Courses</option>
                    <option>Internships</option>
                    <option>Volunteering</option>
                    <option>Extra-Curriculars</option>
                  </select>
                </div>
                <button type="submit" className={`px-4 py-2 rounded-xl ${tone.btn}`}>Submit</button>
              </form>
            </div>
          )}
        </div>
      </div>

      {/* Edit Personal Details Modal */}
      {showEditModal && (
        <div className="fixed inset-0 flex items-center justify-center z-50">
          <div className="absolute inset-0 bg-black/50" onClick={() => setShowEditModal(false)} />
          <div className={`${tone.card} ${tone.text} border ${tone.border} rounded-2xl p-6 w-full max-w-md relative z-10`}>
            <h2 className="text-xl font-semibold mb-4">Edit Personal Details</h2>
            <form
              className="space-y-4"
              onSubmit={(e) => {
                e.preventDefault();
                setShowEditModal(false);
                showSuccess("Profile updated successfully");
              }}
            >
              <div>
                <label className="block text-sm mb-1">Profile Photo</label>
                <input type="file" className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} />
              </div>
              <div>
                <label className="block text-sm mb-1">Email ID</label>
                <input type="email" defaultValue={dummyData.email} className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} />
              </div>
              <div>
                <label className="block text-sm mb-1">Contact No</label>
                <input type="tel" defaultValue={dummyData.contact} className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} />
              </div>
              <div className="flex justify-end gap-2 pt-2">
                <button type="button" onClick={() => setShowEditModal(false)} className={`px-4 py-2 rounded-xl ${tone.hover} border ${tone.border}`}>
                  Cancel
                </button>
                <button type="submit" className={`px-4 py-2 rounded-xl ${tone.btn}`}>Save</button>
              </div>
            </form>
          </div>
        </div>
      )}

      {/* Change Password Modal */}
      {showPwdModal && (
        <div className="fixed inset-0 flex items-center justify-center z-50">
          <div className="absolute inset-0 bg-black/50" onClick={() => setShowPwdModal(false)} />
          <div className={`${tone.card} ${tone.text} border ${tone.border} rounded-2xl p-6 w-full max-w-md relative z-10`}>
            <h2 className="text-xl font-semibold mb-4">Change Password</h2>
            <form
              className="space-y-4"
              onSubmit={(e) => {
                e.preventDefault();
                setShowPwdModal(false);
                showSuccess("Password changed successfully");
              }}
            >
              <div>
                <label className="block text-sm mb-1">Old Password</label>
                <input type="password" className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} />
              </div>
              <div>
                <label className="block text-sm mb-1">New Password</label>
                <input type="password" className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} />
              </div>
              <div>
                <label className="block text-sm mb-1">Confirm New Password</label>
                <input type="password" className={`w-full border ${tone.border} ${tone.card} rounded-xl p-2`} />
              </div>
              <div className="flex justify-end gap-2 pt-2">
                <button type="button" onClick={() => setShowPwdModal(false)} className={`px-4 py-2 rounded-xl ${tone.hover} border ${tone.border}`}>
                  Cancel
                </button>
                <button type="submit" className={`px-4 py-2 rounded-xl ${tone.btn}`}>Update</button>
              </div>
            </form>
          </div>
        </div>
      )}

      {/* Toast */}
      {toast && (
        <div className="fixed bottom-4 right-4 z-50">
          <div className={`${tone.card} border ${tone.border} rounded-2xl px-4 py-3 flex items-center gap-2 shadow-lg`}>
            <div className="rounded-full p-1 bg-green-500/20">
              <Smile className="text-green-500" size={18} />
            </div>
            <span>{toast.message}</span>
          </div>
        </div>
      )}
    </div>
  );
}
